SET SQLPROMPT "";
SET SQLNUMBER OFF;


CONNECT SYSTEM/SYSTEM;

DROP USER E09 CASCADE;
CREATE USER E09 IDENTIFIED BY "E09";
GRANT CONNECT,RESOURCE TO E09;


CONNECT E09/E09;

CREATE TABLE CLIENTE 
(
  DNI        CHAR(9),
  NOMBRE     VARCHAR2(40), 
  DIRECCION  VARCHAR2(40),
  LOCALIDAD  VARCHAR2(40),
  FECHA_NAC  DATE,
  SEXO       CHAR(1)
);

ALTER TABLE CLIENTE ADD CONSTRAINT PK_CLIENTE PRIMARY KEY(DNI);


CREATE TABLE SUCURSAL
(
  CODSUCURSAL NUMBER(4),
  NOMBRE      VARCHAR2(40),
  DIRECCION   VARCHAR2(40),
  LOCALIDAD   VARCHAR2(40)
);

ALTER TABLE SUCURSAL ADD CONSTRAINT PK_SUCURSAL 
  PRIMARY KEY(CODSUCURSAL);


CREATE SEQUENCE NUMSUCURSAL;

CREATE INDEX NOMBRE_CLIENTE_IDX     ON CLIENTE (NOMBRE);
CREATE INDEX LOCALIDAD_CLIENTE_IDX  ON CLIENTE (LOCALIDAD);
CREATE INDEX NOMBRE_SUCURSAL_IDX    ON SUCURSAL (NOMBRE);
CREATE INDEX LOCALIDAD_SUCURSAL_IDX ON SUCURSAL (LOCALIDAD);


CREATE TABLE CUENTA
(
  CODSUCURSAL NUMBER(4),
  CODCUENTA   NUMBER(10)
);

ALTER TABLE CUENTA ADD CONSTRAINT PK_CUENTA 
  PRIMARY KEY(CODSUCURSAL, CODCUENTA);

ALTER TABLE CUENTA ADD CONSTRAINT FK_CUENTA 
  FOREIGN KEY(CODSUCURSAL) REFERENCES SUCURSAL(CODSUCURSAL);

CREATE TABLE TRANSACCION
(
  CODSUCURSAL    NUMBER(4),
  CODCUENTA      NUMBER(10),
  NUMTRANSACCION NUMBER(5),
  FECHA          DATE,
  TIPO           VARCHAR2(20)
);

ALTER TABLE TRANSACCION ADD CONSTRAINT PK_TRANSACCION 
  PRIMARY KEY (CODSUCURSAL, CODCUENTA, NUMTRANSACCION);

ALTER TABLE TRANSACCION ADD CONSTRAINT FK_TRANSACCION
  FOREIGN KEY (CODSUCURSAL, CODCUENTA) 
  REFERENCES CUENTA (CODSUCURSAL, CODCUENTA);


CREATE TABLE CLI_CUENTA
(
  DNI         CHAR(9),
  CODSUCURSAL NUMBER(4),
  CODCUENTA   NUMBER(10)
);

ALTER TABLE CLI_CUENTA ADD CONSTRAINT PK_CLI_CUENTA
  PRIMARY KEY (DNI, CODSUCURSAL, CODCUENTA);

ALTER TABLE CLI_CUENTA ADD CONSTRAINT FK1_CLI_CUENTA
  FOREIGN KEY (DNI) REFERENCES CLIENTE(DNI);

ALTER TABLE CLI_CUENTA ADD CONSTRAINT FK2_CLI_CUENTA
  FOREIGN KEY (CODSUCURSAL, CODCUENTA) 
  REFERENCES CUENTA(CODSUCURSAL, CODCUENTA);
