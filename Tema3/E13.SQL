SET SQLPROMPT "";
SET SQLNUMBER OFF;


CONNECT SYSTEM/SYSTEM;

DROP USER E13 CASCADE;
CREATE USER E13 IDENTIFIED BY "E13";
GRANT CONNECT,RESOURCE TO E13;


CONNECT E13/E13;

CREATE TABLE CCC
(
  IDCUENTA    NUMBER(7),
  CODBANCO    NUMBER(4),
  CODSUCURSAL NUMBER(4),
  NUMCUENTA   NUMBER(10)
);

ALTER TABLE CCC ADD CONSTRAINT PK_CCC
  PRIMARY KEY(IDCUENTA);

ALTER TABLE CCC ADD CONSTRAINT UQ_CCC
  UNIQUE (CODBANCO,CODSUCURSAL,NUMCUENTA);

CREATE SEQUENCE IDCUENTA;  

  
CREATE TABLE EMPLEADO
(
  CODEMP    NUMBER(5),
  NIF       CHAR(9),
  NOMBRE    VARCHAR2(40),
  NUMHIJOS  NUMBER(2),
  RETENCION NUMBER(4,2),
  TELEFONO  CHAR(9),
  IDCUENTA  NUMBER(7)
);

ALTER TABLE EMPLEADO ADD CONSTRAINT PK_EMPLEADO
  PRIMARY KEY(CODEMP);

ALTER TABLE EMPLEADO ADD CONSTRAINT UQ_EMPLEADO
  UNIQUE (NIF);
  
ALTER TABLE EMPLEADO ADD CONSTRAINT FK_EMPLEADO
  FOREIGN KEY(IDCUENTA) REFERENCES CCC(IDCUENTA);
  
  
CREATE TABLE NOMINA
(
    IDNOMINA     NUMBER(7),
    IDCUENTA     NUMBER(7),
    EJERCFISCAL  NUMBER(4),
    MES          VARCHAR2(15),
    NUMORDEN     NUMBER(1),
    CODEMP       NUMBER(5)
);

ALTER TABLE NOMINA ADD CONSTRAINT PK_NOMINA
  PRIMARY KEY(IDNOMINA);

ALTER TABLE NOMINA ADD CONSTRAINT UQ_NOMINA
  UNIQUE (IDCUENTA,EJERCFISCAL,MES,NUMORDEN);
  
ALTER TABLE NOMINA ADD CONSTRAINT FK1_NOMINA
  FOREIGN KEY(IDCUENTA) REFERENCES CCC(IDCUENTA);

ALTER TABLE NOMINA ADD CONSTRAINT FK2_NOMINA
  FOREIGN KEY(CODEMP) REFERENCES EMPLEADO(CODEMP);
  
CREATE SEQUENCE IDNOMINA;  
 

CREATE TABLE DEPARTAMENTO
(
  CODDPTO  NUMBER(3),
  NOMBRE   VARCHAR2(40)
);

ALTER TABLE DEPARTAMENTO ADD CONSTRAINT PK_DEPARTAMENTO
  PRIMARY KEY(CODDPTO);
  

CREATE TABLE SEDE
(
  CODSEDE  NUMBER(2),
  NOMBRE   VARCHAR2(40),
  CODDPTO  NUMBER(3)
);

ALTER TABLE SEDE ADD CONSTRAINT PK_SEDE
  PRIMARY KEY(CODSEDE);
  
ALTER TABLE SEDE ADD CONSTRAINT FK_SEDE
  FOREIGN KEY(CODDPTO) REFERENCES DEPARTAMENTO(CODDPTO);
  
  
CREATE TABLE TRABAJA
(
  CODEMP   NUMBER(5),
  CODDPTO  NUMBER(3),
  FUNCION  VARCHAR2(50)
);

ALTER TABLE TRABAJA ADD CONSTRAINT PK_TRABAJA
  PRIMARY KEY(CODEMP,CODDPTO);
  
ALTER TABLE TRABAJA ADD CONSTRAINT FK1_TRABAJA
  FOREIGN KEY(CODEMP) REFERENCES EMPLEADO(CODEMP);

ALTER TABLE TRABAJA ADD CONSTRAINT FK2_TRABAJA
  FOREIGN KEY(CODDPTO) REFERENCES DEPARTAMENTO(CODDPTO);


CREATE TABLE CONCEPTORETRIBUTIVO
(
  COD         NUMBER(2),
  DESCRIPCION VARCHAR2(100)
);

ALTER TABLE CONCEPTORETRIBUTIVO ADD CONSTRAINT PK_CONCEPTORETRIBUTIVO
  PRIMARY KEY (COD);
  
  
CREATE TABLE INGRESO 
(
  IDNOMINA  NUMBER(7),
  LINEANUM  NUMBER(3),
  CANTIDAD  NUMBER,
  CONCEPTO  NUMBER(2)
);

ALTER TABLE INGRESO ADD CONSTRAINT PK_INGRESO
  PRIMARY KEY (IDNOMINA,LINEANUM);

ALTER TABLE INGRESO ADD CONSTRAINT FK1_INGRESO
  FOREIGN KEY(IDNOMINA) REFERENCES NOMINA(IDNOMINA);
  
ALTER TABLE INGRESO ADD CONSTRAINT FK2_INGRESO
  FOREIGN KEY(CONCEPTO) REFERENCES CONCEPTORETRIBUTIVO(COD);
  
  
CREATE TABLE DESCUENTO 
(
  IDNOMINA   NUMBER(7),
  LINEANUM   NUMBER(3),
  CANTIDAD   NUMBER,
  BASE       NUMBER,
  PORCENTAJE NUMBER(4,2)
);

ALTER TABLE DESCUENTO ADD CONSTRAINT PK_DESCUENTO
  PRIMARY KEY (IDNOMINA,LINEANUM);
  
ALTER TABLE DESCUENTO ADD CONSTRAINT FK_DESCUENTO
  FOREIGN KEY(IDNOMINA) REFERENCES NOMINA(IDNOMINA);

CREATE SEQUENCE LINEANUM;



