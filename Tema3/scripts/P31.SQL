SET SQLPROMPT "";
SET SQLNUMBER OFF;


CONNECT SYSTEM/SYSTEM;

DROP USER P31 CASCADE;
CREATE USER P31 IDENTIFIED BY "P31";
GRANT CONNECT,RESOURCE TO P31;


CONNECT P31/P31;


CREATE TABLE EQUIPO
(
  CODIGO  NUMBER(3) PRIMARY KEY,
  NOMBRE  VARCHAR2(50),
  ESTADIO VARCHAR2(50),
  AFORO   NUMBER(5) DEFAULT 0,
  CIUDAD  VARCHAR2(20)  
);


CREATE TABLE PRESIDENTE
(
  DNI            CHAR(9) PRIMARY KEY,
  NOMBRE         VARCHAR2(50),
  APELLIDOS      VARCHAR2(50),
  FECHAELECCION  DATE,
  FECHANAC       DATE, 
  EQUIPO         UNIQUE REFERENCES EQUIPO
);

CREATE TABLE PARTIDO
(
  CODIGO       NUMBER(3) PRIMARY KEY,
  FECHA        DATE NOT NULL,
  EQLOCAL      NUMBER(3) REFERENCES EQUIPO,
  EQVISITANTE  NUMBER(3) REFERENCES EQUIPO,
  CONSTRAINT FECHA_PARTIDOS
    CHECK (TO_CHAR(FECHA, 'MMDD') NOT BETWEEN '0621' AND '0921'),
  CONSTRAINT DIST_EQUIPOS
    CHECK (EQLOCAL <> EQVISITANTE)
);


CREATE TABLE JUGADOR
(
  CODIGO         NUMBER(4) PRIMARY KEY,
  NOMBRE         VARCHAR2(50),
  FECHAALTA      DATE DEFAULT SYSDATE,
  FECHANAC       DATE, 
  POSICION       VARCHAR2(50) 
    CHECK (POSICION IN 
      ('PORTERO', 'DEFENSA', 'CENTROCAMPISTA','DELANTERO')),
  CONSTRAINT EDAD 
    CHECK ( MONTHS_BETWEEN (FECHAALTA,FECHANAC) >= 16*12 )
);


CREATE TABLE GOLES
(
  CODPARTIDO  NUMBER(3) REFERENCES PARTIDO,
  CODJUGADOR  NUMBER(3) REFERENCES JUGADOR,
  MINUTO      NUMBER(3) CHECK (MINUTO <= 100),
  DESCRIPCION VARCHAR2(100),
  PRIMARY KEY (CODPARTIDO,CODJUGADOR)
);



ALTER TABLE EQUIPO  ADD (NUMTITULOS NUMBER(2));
ALTER TABLE EQUIPO  DROP COLUMN CIUDAD;
ALTER TABLE EQUIPO  ADD (FUNDACION NUMBER(4) CHECK (FUNDACION > 1890) );
ALTER TABLE PARTIDO ADD CONSTRAINT HORA_PARTIDOS 
  CHECK (TO_CHAR(FECHA, 'HH24MI') BETWEEN '1200' AND '2200');




