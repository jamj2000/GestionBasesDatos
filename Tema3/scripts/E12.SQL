SET SQLPROMPT "";
SET SQLNUMBER OFF;


CONNECT SYSTEM/SYSTEM;

DROP USER E12 CASCADE;
CREATE USER E12 IDENTIFIED BY "E12";
GRANT CONNECT,RESOURCE TO E12;


CONNECT E12/E12;


CREATE TABLE EMPLEADO
(
  CODEMP    NUMBER(5),
  NIF       CHAR(9),
  NOMBRE    VARCHAR2(40),
  APELLIDOS VARCHAR2(40),
  DIRECCION VARCHAR2(40),
  TELEFONO  CHAR(9),
  FECHANAC  DATE,
  SALARIO   NUMBER
);

ALTER TABLE EMPLEADO ADD CONSTRAINT PK_EMPLEADO
  PRIMARY KEY(CODEMP);

CREATE INDEX APELLIDOS_EMP_IDX ON EMPLEADO(APELLIDOS);

  
CREATE TABLE EMPCAPACITADO ( CODEMP    NUMBER(5) );

ALTER TABLE EMPCAPACITADO ADD CONSTRAINT PK_EMPCAPACITADO
  PRIMARY KEY(CODEMP);

ALTER TABLE EMPCAPACITADO ADD CONSTRAINT FK_EMPCAPACITADO
  FOREIGN KEY(CODEMP) REFERENCES EMPLEADO(CODEMP);


CREATE TABLE EMPNOCAPACITADO ( CODEMP    NUMBER(5) );

ALTER TABLE EMPNOCAPACITADO ADD CONSTRAINT PK_EMPNOCAPACITADO
  PRIMARY KEY(CODEMP);

ALTER TABLE EMPNOCAPACITADO ADD CONSTRAINT FK_EMPNOCAPACITADO
  FOREIGN KEY(CODEMP) REFERENCES EMPLEADO(CODEMP);


CREATE TABLE CURSO
(
  CODCURSO  NUMBER(3),
  NOMBRE    VARCHAR2(40),
  DURACION  NUMBER(3),
  COSTE     NUMBER
);

ALTER TABLE CURSO ADD CONSTRAINT PK_CURSO
  PRIMARY KEY(CODCURSO);

  
CREATE TABLE EDICION
(
  CODCURSO    NUMBER(3),
  FECHAINICIO DATE,
  LUGAR       VARCHAR2(40),
  HORARIO     VARCHAR2(40),
  PROFESOR    NUMBER(5)
);

ALTER TABLE EDICION ADD CONSTRAINT PK_EDICION
  PRIMARY KEY(CODCURSO,FECHAINICIO);

ALTER TABLE EDICION ADD CONSTRAINT FK1_EDICION
  FOREIGN KEY(CODCURSO) REFERENCES CURSO(CODCURSO);

ALTER TABLE EDICION ADD CONSTRAINT FK2_EDICION
  FOREIGN KEY(PROFESOR) REFERENCES EMPCAPACITADO(CODEMP);

CREATE INDEX LUGAR_EDICION_IDX   ON EDICION(LUGAR);
CREATE INDEX HORARIO_EDICION_IDX ON EDICION(HORARIO);

  
CREATE TABLE RECIBE
(
  CODEMPLEADO NUMBER(5),
  CODCURSO    NUMBER(3),
  FECHAINICIO DATE
);

ALTER TABLE RECIBE ADD CONSTRAINT PK_RECIBE
  PRIMARY KEY(CODEMPLEADO,CODCURSO,FECHAINICIO);

ALTER TABLE RECIBE ADD CONSTRAINT FK1_RECIBE
  FOREIGN KEY(CODEMPLEADO) REFERENCES EMPLEADO(CODEMP);
  
ALTER TABLE RECIBE ADD CONSTRAINT FK2_RECIBE
  FOREIGN KEY(CODCURSO,FECHAINICIO) 
  REFERENCES EDICION(CODCURSO,FECHAINICIO);

  
CREATE TABLE PRERREQUISITO
(
  CURSOSOLICITADO NUMBER(3),
  CURSOPREVIO     NUMBER(3),
  OBLIGATORIO     CHAR(1)
);

ALTER TABLE PRERREQUISITO ADD CONSTRAINT PK_PRERREQUISITO
  PRIMARY KEY(CURSOSOLICITADO,CURSOPREVIO,OBLIGATORIO);

ALTER TABLE PRERREQUISITO ADD CONSTRAINT FK1_PRERREQUISITO
  FOREIGN KEY(CURSOSOLICITADO) REFERENCES CURSO(CODCURSO);
  
ALTER TABLE PRERREQUISITO ADD CONSTRAINT FK2_PRERREQUISITO
  FOREIGN KEY(CURSOPREVIO) REFERENCES CURSO(CODCURSO);
  
ALTER TABLE PRERREQUISITO ADD CONSTRAINT CK_OBLIGATORIO
  CHECK (OBLIGATORIO IN ('S', 'N'));  

