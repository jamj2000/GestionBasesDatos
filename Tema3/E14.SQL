SET SQLPROMPT "";
SET SQLNUMBER OFF;


CONNECT SYSTEM/SYSTEM;

DROP USER E14 CASCADE;
CREATE USER E14 IDENTIFIED BY "E14";
GRANT CONNECT,RESOURCE TO E14;


CONNECT E14/E14;


CREATE TABLE PARQUENATURAL 
(
  CODPN             NUMBER(4),
  NOMBRE            VARCHAR2(40),
  FECHADECLARACION  DATE
);

ALTER TABLE PARQUENATURAL ADD CONSTRAINT PK_PARQUE
  PRIMARY KEY(CODPN);

  
CREATE TABLE COMUNIDADAUTONOMA
(
  CODCA          NUMBER(4),
  NOMBRE         VARCHAR2(40),
  ORGRESONSABLE  VARCHAR2(40)
);

ALTER TABLE COMUNIDADAUTONOMA ADD CONSTRAINT PK_COMUNIDAD
  PRIMARY KEY(CODCA);


CREATE TABLE CA_PN
(
  CODCA NUMBER(4),
  CODPN NUMBER(4)
);

ALTER TABLE CA_PN ADD CONSTRAINT PK_CA_PN
  PRIMARY KEY(CODCA,CODPN);
  
ALTER TABLE CA_PN ADD CONSTRAINT FK1_CA_PN
  FOREIGN KEY(CODCA) REFERENCES COMUNIDADAUTONOMA(CODCA);

ALTER TABLE CA_PN ADD CONSTRAINT FK2_CA_PN
  FOREIGN KEY(CODPN) REFERENCES PARQUENATURAL(CODPN);


CREATE TABLE ENTRADA 
(
  CODENTRADA  NUMBER(2),   
  CODPN       NUMBER(4)
);

ALTER TABLE ENTRADA ADD CONSTRAINT PK_ENTRADA
  PRIMARY KEY(CODENTRADA);
  
ALTER TABLE ENTRADA ADD CONSTRAINT FK_ENTRADA
  FOREIGN KEY(CODPN) REFERENCES PARQUENATURAL(CODPN);
  
  
CREATE TABLE ALOJAMIENTO 
(
  CODALOJAMIENTO  NUMBER(2),   
  CATEGORIA       VARCHAR2(20),
  CAPACIDAD       NUMBER(3),
  CODPN           NUMBER(4)
);

ALTER TABLE ALOJAMIENTO ADD CONSTRAINT PK_ALOJAMIENTO
  PRIMARY KEY(CODALOJAMIENTO);
  
ALTER TABLE ALOJAMIENTO ADD CONSTRAINT FK_ALOJAMIENTO
  FOREIGN KEY(CODPN) REFERENCES PARQUENATURAL(CODPN);

  
CREATE TABLE EXCURSION 
(
  CODEXCURSION   NUMBER(4), 
  FECHA_HORA     DATE,
  APIE           CHAR(1),
  CODALOJAMIENTO NUMBER(2)
);

ALTER TABLE EXCURSION ADD CONSTRAINT PK_EXCURSION
  PRIMARY KEY(CODEXCURSION);
  
ALTER TABLE EXCURSION ADD CONSTRAINT FK_EXCURSION
  FOREIGN KEY(CODALOJAMIENTO) REFERENCES ALOJAMIENTO(CODALOJAMIENTO);

ALTER TABLE EXCURSION ADD CONSTRAINT CK_EXCURSION
  CHECK (APIE IN ('S', 'N'));


CREATE TABLE VISITANTE 
(
  DNI       CHAR(9), 
  NOMBRE    VARCHAR2(50),
  DOMICILIO VARCHAR2(100),
  PROFESION VARCHAR2(40)
);

ALTER TABLE VISITANTE ADD CONSTRAINT PK_VISITANTE
  PRIMARY KEY(DNI);


CREATE TABLE VISITANTE_EXCURSION
(
  CODEXCURSION NUMBER(4),
  DNI          CHAR(9)
);

ALTER TABLE VISITANTE_EXCURSION ADD CONSTRAINT PK_V_E
  PRIMARY KEY(CODEXCURSION,DNI);
  
ALTER TABLE VISITANTE_EXCURSION ADD CONSTRAINT FK1_V_E
  FOREIGN KEY(CODEXCURSION) REFERENCES EXCURSION(CODEXCURSION);

ALTER TABLE VISITANTE_EXCURSION ADD CONSTRAINT FK2_V_E
  FOREIGN KEY(DNI) REFERENCES VISITANTE(DNI);

  
CREATE TABLE VISITANTE_ALOJAMIENTO
(
  CODALOJAMIENTO NUMBER(2),
  DNI            CHAR(9),
  FECHAINICIO    DATE,
  FECHAFIN       DATE
);

ALTER TABLE VISITANTE_ALOJAMIENTO ADD CONSTRAINT PK_V_A
  PRIMARY KEY(CODALOJAMIENTO,DNI,FECHAINICIO);
  
ALTER TABLE VISITANTE_ALOJAMIENTO ADD CONSTRAINT FK1_V_A
  FOREIGN KEY(CODALOJAMIENTO) REFERENCES ALOJAMIENTO(CODALOJAMIENTO);

ALTER TABLE VISITANTE_ALOJAMIENTO ADD CONSTRAINT FK2_V_A
  FOREIGN KEY(DNI) REFERENCES VISITANTE(DNI);

  
CREATE TABLE AREA
(
  NOMBREAREA VARCHAR2(20),
  EXTENSION  NUMBER(4),
  CODPN      NUMBER(4)
);

ALTER TABLE AREA ADD CONSTRAINT PK_AREA
  PRIMARY KEY(NOMBREAREA);
  
ALTER TABLE AREA ADD CONSTRAINT FK1_AREA
  FOREIGN KEY(CODPN) REFERENCES PARQUENATURAL(CODPN);

  
CREATE TABLE ESPECIE
(
  CODESPECIE        NUMBER(4),
  NOMBRECIENTIFICO  VARCHAR2(100),
  NOMBREVULGAR      VARCHAR2(100)
);

ALTER TABLE ESPECIE ADD CONSTRAINT PK_ESPECIE
  PRIMARY KEY(CODESPECIE);


CREATE TABLE ESPECIE_AREA 
(
  CODESPECIE     NUMBER(4),
  NOMBREAREA     VARCHAR2(20),
  CANTINDIVIDUOS NUMBER(6)
);

ALTER TABLE ESPECIE_AREA ADD CONSTRAINT PK_E_A
  PRIMARY KEY(CODESPECIE,NOMBREAREA);
  
ALTER TABLE ESPECIE_AREA ADD CONSTRAINT FK1_E_A
  FOREIGN KEY(CODESPECIE) REFERENCES ESPECIE(CODESPECIE);

ALTER TABLE ESPECIE_AREA ADD CONSTRAINT FK2_E_A
  FOREIGN KEY(NOMBREAREA) REFERENCES AREA(NOMBREAREA);
  
  
CREATE TABLE ANIMAL
(
  CODESPECIE     NUMBER(4),
  ALIMENTACION   VARCHAR2(100),
  PERIODOCELO    VARCHAR2(20)
);

ALTER TABLE ANIMAL ADD CONSTRAINT PK_ANIMAL
  PRIMARY KEY(CODESPECIE);
  
ALTER TABLE ANIMAL ADD CONSTRAINT FK_ANIMAL
  FOREIGN KEY(CODESPECIE) REFERENCES ESPECIE(CODESPECIE);

  
  
CREATE TABLE VEGETAL
(
  CODESPECIE       NUMBER(4),
  FLORACION        VARCHAR2(20),
  PERIODOFLORACION VARCHAR2(20)
);

ALTER TABLE VEGETAL ADD CONSTRAINT PK_VEGETAL
  PRIMARY KEY(CODESPECIE);
  
ALTER TABLE VEGETAL ADD CONSTRAINT FK_VEGETAL
  FOREIGN KEY(CODESPECIE) REFERENCES ESPECIE(CODESPECIE);
  

CREATE TABLE MINERAL
(
  CODESPECIE  NUMBER(4),
  TIPO        VARCHAR2(20)
);

ALTER TABLE MINERAL ADD CONSTRAINT PK_MINERAL
  PRIMARY KEY(CODESPECIE);
  
ALTER TABLE MINERAL ADD CONSTRAINT FK_MINERAL
  FOREIGN KEY(CODESPECIE) REFERENCES ESPECIE(CODESPECIE);
  

CREATE TABLE PERSONAL
(
  DNI        CHAR(9),
  NSS        CHAR(12),
  NOMBRE     VARCHAR2(40),
  DIRECCION  VARCHAR2(100),
  TFNOFIJO   CHAR(9),
  TFNOMOVIL  CHAR(9),
  SUELDO     NUMBER,
  CODPN      NUMBER(4)
);

ALTER TABLE PERSONAL ADD CONSTRAINT PK_PERSONAL
  PRIMARY KEY(DNI);
  
ALTER TABLE PERSONAL ADD CONSTRAINT UQ_PERSONAL
  UNIQUE(NSS);
  
ALTER TABLE PERSONAL ADD CONSTRAINT FK_PERSONAL
  FOREIGN KEY(CODPN) REFERENCES PARQUENATURAL(CODPN);


CREATE TABLE CONSERVADOR
(
  DNI        CHAR(9),
  TAREA      VARCHAR2(40),
  NOMBREAREA VARCHAR2(20)
);

ALTER TABLE CONSERVADOR ADD CONSTRAINT PK_CONSERVADOR
  PRIMARY KEY(DNI);
  
ALTER TABLE CONSERVADOR ADD CONSTRAINT FK1_CONSERVADOR
  FOREIGN KEY(DNI) REFERENCES PERSONAL(DNI);
  
ALTER TABLE CONSERVADOR ADD CONSTRAINT FK2_CONSERVADOR
  FOREIGN KEY(NOMBREAREA) REFERENCES AREA(NOMBREAREA);

  
CREATE TABLE VIGILANTE
(
  DNI        CHAR(9),
  NOMBREAREA VARCHAR2(20)
);

ALTER TABLE VIGILANTE ADD CONSTRAINT PK_VIGILANTE
  PRIMARY KEY(DNI);
  
ALTER TABLE VIGILANTE ADD CONSTRAINT FK1_VIGILANTE
  FOREIGN KEY(DNI) REFERENCES PERSONAL(DNI);
  
ALTER TABLE VIGILANTE ADD CONSTRAINT FK2_VIGILANTE
  FOREIGN KEY(NOMBREAREA) REFERENCES AREA(NOMBREAREA);

  
CREATE TABLE INVESTIGADOR
(
  DNI        CHAR(9),
  TITULACION VARCHAR2(100)
);

ALTER TABLE INVESTIGADOR ADD CONSTRAINT PK_INVESTIGADOR
  PRIMARY KEY(DNI);
  
ALTER TABLE INVESTIGADOR ADD CONSTRAINT FK1_INVESTIGADOR
  FOREIGN KEY(DNI) REFERENCES PERSONAL(DNI);
  

CREATE TABLE GESTOR
(
  DNI        CHAR(9),
  CODENTRADA NUMBER(2)
);

ALTER TABLE GESTOR ADD CONSTRAINT PK_GESTOR
  PRIMARY KEY(DNI);
  
ALTER TABLE GESTOR ADD CONSTRAINT FK1_GESTOR
  FOREIGN KEY(DNI) REFERENCES PERSONAL(DNI);

ALTER TABLE GESTOR ADD CONSTRAINT FK2_GESTOR
  FOREIGN KEY(CODENTRADA) REFERENCES ENTRADA(CODENTRADA);
  

CREATE TABLE PROYECTO
(
  CODPROYECTO  NUMBER(4),
  PRESUPUESTO  NUMBER,
  FECHAINICIO  DATE,
  FECHAFIN     DATE,
  CODESPECIE   NUMBER(4)
);

ALTER TABLE PROYECTO ADD CONSTRAINT PK_PROYECTO
  PRIMARY KEY(CODPROYECTO);
  
ALTER TABLE PROYECTO ADD CONSTRAINT FK1_PROYECTO
  FOREIGN KEY(CODESPECIE) REFERENCES ESPECIE(CODESPECIE);

  
CREATE TABLE INVESTIGADOR_PROYECTO
(
  CODPROYECTO  NUMBER(4),
  DNI          CHAR(9)
);

ALTER TABLE INVESTIGADOR_PROYECTO ADD CONSTRAINT PK_I_P
  PRIMARY KEY(CODPROYECTO,DNI);
  
ALTER TABLE INVESTIGADOR_PROYECTO ADD CONSTRAINT FK1_I_P
  FOREIGN KEY(CODPROYECTO) REFERENCES PROYECTO(CODPROYECTO);
  
ALTER TABLE INVESTIGADOR_PROYECTO ADD CONSTRAINT FK2_I_P
  FOREIGN KEY(DNI) REFERENCES INVESTIGADOR(DNI);
