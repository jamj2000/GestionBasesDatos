SET SQLPROMPT "";
SET SQLNUMBER OFF;


CONNECT SYSTEM/SYSTEM;

DROP USER E11 CASCADE;
CREATE USER E11 IDENTIFIED BY "E11";
GRANT CONNECT,RESOURCE TO E11;


CONNECT E11/E11;

CREATE TABLE CLIENTE 
(
  CODCLIENTE  NUMBER(5),
  NOMBRE      VARCHAR2(40),
  CALLE       VARCHAR2(40),
  NUMERO      NUMBER(3),
  COMUNA      VARCHAR2(40),
  CIUDAD      VARCHAR2(40)
);

ALTER TABLE CLIENTE ADD CONSTRAINT PK_CLIENTE
  PRIMARY KEY (CODCLIENTE);

CREATE INDEX NOMBRECLIENTE_IDX ON CLIENTE(NOMBRE);
CREATE INDEX CIUDADCLIENTE_IDX ON CLIENTE(CIUDAD);


CREATE TABLE VENTA
(
  IDVENTA    NUMBER(7),
  MONTOTOTAL NUMBER,
  CODCLIENTE NUMBER(5)
);

ALTER TABLE VENTA ADD CONSTRAINT PK_VENTA
  PRIMARY KEY (IDVENTA);

ALTER TABLE VENTA ADD CONSTRAINT FK_CLIENTE 
  FOREIGN KEY(CODCLIENTE)
  REFERENCES CLIENTE(CODCLIENTE);

CREATE SEQUENCE NUMVENTA;

  
CREATE TABLE TELEFONO ( NUMERO CHAR (9) );

ALTER TABLE TELEFONO ADD CONSTRAINT PK_TELEFONO
  PRIMARY KEY (NUMERO);


CREATE TABLE CATEGORIA 
(
  IDCATEGORIA  NUMBER(3),
  NOMBRE       VARCHAR2(40),
  DESCRIPCION  VARCHAR2(100)
);

ALTER TABLE CATEGORIA ADD CONSTRAINT PK_CATEGORIA
  PRIMARY KEY (IDCATEGORIA);

CREATE INDEX NOMBRECATEGORIA_IDX ON CATEGORIA(NOMBRE);


CREATE TABLE PROVEEDOR
(
  CODPROVEEDOR NUMBER(5),
  NOMBRE       VARCHAR2(40),
  DIRECCION    VARCHAR2(40),
  TELEFONO     CHAR(9),
  WEB          VARCHAR2(100)
);

ALTER TABLE PROVEEDOR ADD CONSTRAINT PK_PROVEEDOR
  PRIMARY KEY (CODPROVEEDOR);

CREATE INDEX NOMBREPROVEEDOR_IDX ON PROVEEDOR(NOMBRE);


CREATE TABLE PRODUCTO
(
  IDPRODUCTO    NUMBER(5),
  NOMBRE        VARCHAR2(40),
  PRECIO        NUMBER,
  STOCK         NUMBER(6),
  IDCATEGORIA   NUMBER(3),
  IDPROVEEDOR   NUMBER(5)
);

ALTER TABLE PRODUCTO ADD CONSTRAINT PRODUCTO
  PRIMARY KEY (IDPRODUCTO);

ALTER TABLE PRODUCTO ADD CONSTRAINT FK1_PROD_CATEGORIA 
  FOREIGN KEY(IDCATEGORIA)
  REFERENCES CATEGORIA(IDCATEGORIA);
  
ALTER TABLE PRODUCTO ADD CONSTRAINT FK2_PROD_PROVEEDOR 
  FOREIGN KEY(IDPROVEEDOR)
  REFERENCES PROVEEDOR(CODPROVEEDOR);
  

CREATE TABLE ASOCIADO
(
  CODCLIENTE  NUMBER(5),
  NUMTELEFONO CHAR(9)
);

ALTER TABLE ASOCIADO ADD CONSTRAINT PK_ASOCIADO
  PRIMARY KEY (CODCLIENTE, NUMTELEFONO);

ALTER TABLE ASOCIADO ADD CONSTRAINT FK1_CLIENTE 
  FOREIGN KEY(CODCLIENTE)
  REFERENCES CLIENTE(CODCLIENTE);

ALTER TABLE ASOCIADO ADD CONSTRAINT FK2_TELEFONO 
  FOREIGN KEY(NUMTELEFONO)
  REFERENCES TELEFONO(NUMERO);


CREATE TABLE INCLUYE
(
  IDVENTA     NUMBER(7),
  IDPRODUCTO  NUMBER(5),
  CANTIDAD    NUMBER(5),
  PRECIOVENTA NUMBER
);

ALTER TABLE INCLUYE ADD CONSTRAINT PK_INCLUYE
  PRIMARY KEY (IDVENTA, IDPRODUCTO);

ALTER TABLE INCLUYE ADD CONSTRAINT FK1_INCLUYE 
  FOREIGN KEY(IDVENTA)
  REFERENCES VENTA(IDVENTA);

ALTER TABLE INCLUYE ADD CONSTRAINT FK2_INCLUYE 
  FOREIGN KEY(IDPRODUCTO)
  REFERENCES PRODUCTO(IDPRODUCTO);

