SET SQLPROMPT "";
SET SQLNUMBER OFF;


CONNECT SYSTEM/SYSTEM;

DROP USER E06 CASCADE;
CREATE USER E06 IDENTIFIED BY "E06";
GRANT CONNECT,RESOURCE TO E06;


CONNECT E06/E06;

CREATE TABLE SUCURSAL
(
  CODIGO    CHAR(4)      CONSTRAINT PK_SUCURSAL PRIMARY KEY,
  DIRECCION VARCHAR2(40),
  TELEFONO  CHAR(9)
);


CREATE TABLE PERIODISTA
(
  DNI          CHAR(9)      CONSTRAINT PK_PERIODISTA PRIMARY KEY,
  NOMBRE       VARCHAR2(50) CONSTRAINT NN_NOMBRE NOT NULL,
  DIRECCION    VARCHAR2(40),
  TELEFONO     CHAR(9),
  ESPECIALISTA VARCHAR2(40)
);


CREATE TABLE EMPLEADO
(
  DNI       CHAR(9)      CONSTRAINT PK_EMPLEADO PRIMARY KEY,
  NOMBRE    VARCHAR2(50) CONSTRAINT NN_NOMBRE_EMPLEADO NOT NULL,
  DIRECCION VARCHAR2(40),
  TELEFONO  CHAR(9),
  SUCURSAL  CHAR(4)      CONSTRAINT FK_SUCURSAL 
    REFERENCES SUCURSAL(CODIGO)
);


CREATE TABLE REVISTA
(
  NUMREG       CHAR(8)      CONSTRAINT PK_REVISTA PRIMARY KEY,
  TITULO       VARCHAR2(50) CONSTRAINT NN_TITULO NOT NULL,
  PERIODICIDAD VARCHAR2(40) DEFAULT 'MENSUAL',
  TIPO         VARCHAR2(20),
  SUCURSAL     CHAR(4)      CONSTRAINT FK_SUCURSAL_REVISTA 
    REFERENCES SUCURSAL(CODIGO),
  CONSTRAINT CK_PERIODICIDAD
    CHECK (PERIODICIDAD IN 
      ('SEMANAL', 'QUINCENAL', 'MENSUAL', 'TRIMESTRAL', 'ANUAL'))
);


CREATE TABLE NUMREVISTA
(
  NUMREG       CHAR(8),
  NUMERO       NUMBER(3),
  NUMPAGINAS   NUMBER(3),
  FECHA        DATE,
  CANTVENDIDAS NUMBER(6),
  CONSTRAINT PK_NUMREVISTA PRIMARY KEY (NUMREG, NUMERO),
  CONSTRAINT FK_NUMREVISTA FOREIGN KEY(NUMREG) 
    REFERENCES REVISTA(NUMREG),
  CONSTRAINT CK_NUMPAGINAS CHECK (NUMPAGINAS > 0)
);


CREATE TABLE ESCRIBE
(
  NUMREG         CHAR(8),
  DNI_PERIODISTA CHAR(8),
  CONSTRAINT PK_ESCRIBE PRIMARY KEY (NUMREG, DNI_PERIODISTA),
  CONSTRAINT FK1_ESCRIBE FOREIGN KEY(NUMREG) 
    REFERENCES REVISTA(NUMREG),
  CONSTRAINT FK2_ESCRIBE FOREIGN KEY(DNI_PERIODISTA) 
    REFERENCES PERIODISTA(DNI)
);
