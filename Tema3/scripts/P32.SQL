SET SQLPROMPT "";
SET SQLNUMBER OFF;


CONNECT SYSTEM/SYSTEM;

DROP USER P32 CASCADE;
CREATE USER P32 IDENTIFIED BY "P32";
GRANT CONNECT,RESOURCE TO P32;


CONNECT P32/P32;

CREATE TABLE CLIENTE
(
  COD       NUMBER(6) PRIMARY KEY,
  NIF       CHAR(9) 
    CHECK (REGEXP_LIKE (NIF, '[0-9]{8}[A-Z]')) 
    UNIQUE,
  NOMBRE    VARCHAR2(50),
  DIRECCION VARCHAR2(100),
  TELEFONO  CHAR(9) CHECK (REGEXP_LIKE(TELEFONO, '[69][0-9]{8}')),
  CIUDAD    VARCHAR2(20)
);


CREATE TABLE COCHE
(
  MATRICULA  CHAR(7) 
    CHECK (REGEXP_LIKE (MATRICULA, '[0-9]{4}[A-Z]{3}') )
    PRIMARY KEY,
  MARCA      VARCHAR2(20) NOT NULL,
  MODELO     VARCHAR2(20) NOT NULL,
  COLOR      VARCHAR2(20) CHECK (COLOR IN ('ROJO', 'VERDE', 'AZUL')),
  PVP        NUMBER       CHECK (PVP BETWEEN 10000 AND 40000),
  CODCLIENTE NUMBER(6) REFERENCES CLIENTE
);


CREATE TABLE REVISION
(
  COD        NUMBER(7) PRIMARY KEY,
  FECHA      DATE,
  MATRICULA  CHAR(7) REFERENCES COCHE
);


CREATE TABLE OPERACION
(
  COD          NUMBER(3) PRIMARY KEY,
  DESCRIPCION  VARCHAR2(100),
  HORAS        NUMBER CHECK (HORAS > 0 AND HORAS <= 10)
);


CREATE TABLE CONSTA
(
  CODREVISION  NUMBER(7) REFERENCES REVISION,
  CODOPERACION NUMBER(3) REFERENCES OPERACION,
  PRIMARY KEY (CODREVISION,CODOPERACION)
);


CREATE TABLE MATERIAL
(
  COD    NUMBER(4) PRIMARY KEY,
  NOMBRE VARCHAR2(50),
  PRECIO NUMBER
);

CREATE TABLE NECESITA
(
  CODOPERACION NUMBER(3) REFERENCES OPERACION,
  CODMATERIAL  NUMBER(4) REFERENCES MATERIAL,
  PRIMARY KEY (CODOPERACION,CODMATERIAL)
);


